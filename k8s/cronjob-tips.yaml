apiVersion: batch/v1
kind: CronJob
metadata:
  name: longevity-tip-pipeline
  labels:
    app: longevity-tip-pipeline
spec:
  schedule: "30 6 * * *"
  concurrencyPolicy: Forbid
  startingDeadlineSeconds: 3600
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 3
  jobTemplate:
    spec:
      backoffLimit: 0
      activeDeadlineSeconds: 1800
      ttlSecondsAfterFinished: 3600
      template:
        metadata:
          labels:
            app: longevity-tip-pipeline
        spec:
          serviceAccountName: longevity-app
          restartPolicy: Never
          containers:
            - name: tip-pipeline-runner
              image: IMAGE_PLACEHOLDER
              imagePullPolicy: Always
              command: ["python"]
              args:
                - "-m"
                - "app.scripts.run_tip_pipeline"
                - "--limit-per-feed"
                - "4"
                - "--model-provider"
                - "vertex"
                - "--model"
                - "gemini-2.0-flash-lite-001"
              env:
                - name: LIVEON_LOG_LEVEL
                  value: INFO
                - name: GOOGLE_CLOUD_PROJECT
                  value: live-on-473112
                - name: GOOGLE_CLOUD_REGION
                  value: europe-north2
              resources:
                requests:
                  cpu: "250m"
                  memory: "512Mi"
                  ephemeral-storage: "2Gi"
                limits:
                  cpu: "500m"
                  memory: "1Gi"
                  ephemeral-storage: "4Gi"
